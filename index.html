<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥³å…’çš„æ¯æ—¥ä¸­æ–‡æ¢éšª</title>
    <style>
        :root { --p: #6c5ce7; --s: #a29bfe; --bg: #f9f9fb; --text: #2d3436; }
        body { font-family: "Microsoft JhengHei", "æ•™è‚²éƒ¨æ¨™æº–æ¥·æ›¸", sans-serif; background: var(--bg); margin: 0; padding: 0; color: var(--text); }
        
        /* å°è¦½åˆ— */
        nav { background: white; padding: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; justify-content: center; gap: 20px; position: sticky; top: 0; z-index: 100; }
        nav button { padding: 12px 25px; border: none; border-radius: 25px; cursor: pointer; font-size: 1.1rem; font-weight: bold; transition: 0.3s; background: #f1f2f6; color: #747d8c; }
        nav button.active { background: var(--p); color: white; box-shadow: 0 4px 10px rgba(108, 92, 231, 0.3); }

        .container { max-width: 600px; margin: 20px auto; padding: 0 15px; }
        
        /* å­¸ç¿’å¡ç‰‡ */
        .word-card { background: white; border-radius: 20px; padding: 25px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); display: flex; flex-direction: column; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .card-top { display: flex; align-items: center; gap: 25px; }
        .big-char { font-size: 85px; font-weight: bold; color: var(--p); cursor: pointer; line-height: 1; transition: 0.2s; }
        .big-char:hover { transform: scale(1.1); }
        
        .tag { font-size: 0.9rem; padding: 4px 12px; border-radius: 10px; color: white; margin-bottom: 10px; display: inline-block; font-weight: bold; }
        .tag-new { background: #ff7675; }
        .tag-rev { background: #55efc4; }

        .vocab-container { flex-grow: 1; text-align: left; }
        .vocab-group { margin-top: 10px; border-top: 1px dashed #eee; padding-top: 10px; }
        .vocab-item { font-size: 1.3rem; margin: 8px 0; cursor: pointer; color: #444; display: flex; align-items: center; }
        .vocab-item:before { content: "â­"; margin-right: 8px; font-size: 0.9rem; }
        .vocab-item:hover { color: var(--p); }

        /* éŠæˆ²å€åŸŸ */
        #game-tab { display: none; }
        .quiz-card { background: white; padding: 40px 20px; border-radius: 25px; box-shadow: 0 15px 30px rgba(0,0,0,0.1); text-align: center; }
        .score-board { font-size: 1.2rem; color: #ffa502; font-weight: bold; margin-bottom: 20px; }
        .question-text { font-size: 2rem; margin: 30px 0; line-height: 1.5; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .opt-btn { padding: 25px; font-size: 1.8rem; border: 3px solid #f1f2f6; border-radius: 15px; background: white; cursor: pointer; transition: 0.2s; font-weight: bold; }
        .opt-btn:hover { border-color: var(--s); background: #f9f9ff; }

        .loading-hint { color: #a4b0be; font-size: 0.9rem; font-style: italic; }
    </style>
</head>
<body>

    <nav>
        <button id="nav-learn" class="active" onclick="switchTab('learn')">ğŸ“– å­¸ç¿’</button>
        <button id="nav-game" onclick="switchTab('game')">ğŸ® éŠæˆ²</button>
    </nav>

    <div class="container">
        <header style="margin-bottom: 25px;">
            <h2 id="display-date" style="color:#57606f;">è¼‰å…¥ä¸­...</h2>
            <p id="child-greeting" style="font-size: 1.2rem; color: #a4b0be;">ä»Šå¤©ä¹Ÿè¦åŠ æ²¹å–”ï¼ğŸŒŸ</p>
        </header>

        <div id="learn-tab">
            <div id="word-list"></div>
        </div>

        <div id="game-tab">
            <div class="quiz-card">
                <div class="score-board">å¦³å·²ç¶“æ”¶é›†äº† <span id="star-count">0</span> é¡†æ˜Ÿæ˜Ÿ â­</div>
                <div id="quiz-content">
                    <div class="question-text" id="q-text">æ­£åœ¨æº–å‚™é¡Œç›®...</div>
                    <div class="options-grid" id="q-options"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç›´æ¥å°‡æ‚¨çš„ schedule.json è²¼åœ¨é€™è£¡
        const schedule = {
            "2025-12-25": ["å«©","çŒ´","æŠ«","ä¿¡","å¯¦","éµ","åˆ©","åº·","è²§","å¯Œ","å°‡","å®ˆ","è”—","å•ª"],
            "2025-12-26": ["åŒ…","è¨ˆ","çŒ´","å«©","æŠ«","ä¿¡","ç´¢","ä¼¼","è¿°","æ•˜","é™·","å‹¸","ç˜¦","ç¨½"],
            "2025-12-27": ["å¯Ÿ","åµ","è¨ˆ","åŒ…","çŒ´","å«©","å¯¦","éµ","å‚˜","èŸ²","å³","é˜±","å…„","ç°§"],
            "2025-12-28": ["é¡","é‡","åµ","å¯Ÿ","è¨ˆ","åŒ…","æŠ«","ä¿¡","åˆ©","åº·","é„°","æ","æ†‚","å¡Š"],
            "2025-12-29": ["è¿·","è®“","é‡","é¡","åµ","å¯Ÿ","çŒ´","å«©","ç´¢","ä¼¼","å ","çˆ­","é™","æ™º"],
            "2025-12-30": ["çˆ›","ç«‹","è®“","è¿·","é‡","é¡","è¨ˆ","åŒ…","å¯¦","éµ","è²§","å¯Œ","é‘½","æ“"],
            "2025-12-31": ["å","é¡§","ç«‹","çˆ›","è®“","è¿·","åµ","å¯Ÿ","æŠ«","ä¿¡","è¿°","æ•˜","è©","æ¿"]
            // ... æ‚¨å¯ä»¥ç¹¼çºŒæŠŠå…¶ä»–æ—¥æœŸè²¼é€²ä¾†
        };

        let todayWords = [];
        let score = 0;
        const synth = window.speechSynthesis;

        function speak(text) {
            if (synth.speaking) synth.cancel();
            const utter = new SpeechSynthesisUtterance(text);
            utter.lang = 'zh-TW';
            utter.rate = 0.7; // æ…¢ä¸€é»æ¯”è¼ƒæ¸…æ¥š
            synth.speak(utter);
        }

        async function getVocab(char) {
            // ä½¿ç”¨ corsproxy.io è§£æ±ºæœ¬åœ°ç«¯å­˜å–èŒå…¸ API è¢«å°é–çš„å•é¡Œ
            const proxy = "https://corsproxy.io/?";
            const target = `https://www.moedict.tw/api/v2/index/${encodeURIComponent(char)}`;
            try {
                const res = await fetch(proxy + encodeURIComponent(target));
                const data = await res.json();
                const all = data.relates || [];
                return {
                    v2: all.filter(v => v.length === 2).slice(0, 3),
                    v3: all.filter(v => v.length === 3).slice(0, 1),
                    v4: all.filter(v => v.length >= 4).slice(0, 1)
                };
            } catch (e) {
                return { v2: [char+"å­", "é€™"+char], v3: [], v4: [] }; // å¤±æ•—æ™‚çš„ç°¡å–®å‚™æ¡ˆ
            }
        }

        function init() {
            const today = new Date().toISOString().split('T')[0];
            // ç‚ºäº†æ¸¬è©¦ï¼Œå¦‚æœä»Šå¤©ä¸åœ¨æ¸…å–®ï¼Œå°±ç”¨æ¸…å–®çš„ç¬¬ä¸€å¤©
            const dateKey = schedule[today] ? today : Object.keys(schedule)[0];
            todayWords = schedule[dateKey];
            document.getElementById('display-date').innerText = "ğŸ“… " + dateKey;
            
            renderLearn();
        }

        async function renderLearn() {
            const list = document.getElementById('word-list');
            list.innerHTML = "<p class='loading-hint'>æ­£åœ¨å¾é›²ç«¯è¾­å…¸æ‰¾èªè©ï¼Œè«‹ç¨ç­‰ä¸€ä¸‹ä¸‹å–”...</p>";
            
            let html = "";
            for (let i = 0; i < todayWords.length; i++) {
                const char = todayWords[i];
                const voc = await getVocab(char);
                const isNew = i < 2;

                html += `
                    <div class="word-card">
                        <div class="card-top">
                            <div>
                                <span class="tag ${isNew ? 'tag-new' : 'tag-rev'}">${isNew ? 'âœ¨ ä»Šæ—¥æ–°è©' : 'ğŸ”„ æº«ç¿’ä¸€ä¸‹'}</span>
                                <div class="big-char" onclick="speak('${char}')">${char}</div>
                            </div>
                            <div class="vocab-container">
                                <div class="vocab-group">
                                    ${voc.v2.map(v => `<div class="vocab-item" onclick="speak('${v}')">${v}</div>`).join('')}
                                    ${voc.v3.map(v => `<div class="vocab-item" onclick="speak('${v}')">${v}</div>`).join('')}
                                    ${voc.v4.map(v => `<div class="vocab-item" onclick="speak('${v}')">${v}</div>`).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            list.innerHTML = html;
        }

        function switchTab(tab) {
            document.getElementById('learn-tab').style.display = tab === 'learn' ? 'block' : 'none';
            document.getElementById('game-tab').style.display = tab === 'game' ? 'block' : 'none';
            document.getElementById('nav-learn').classList.toggle('active', tab === 'learn');
            document.getElementById('nav-game').classList.toggle('active', tab === 'game');
            if(tab === 'game') startQuiz();
        }

        async function startQuiz() {
            const qText = document.getElementById('q-text');
            const qOpts = document.getElementById('q-options');
            qText.innerText = "ğŸ² é¡Œç›®æ­£åœ¨é£›éä¾†...";
            qOpts.innerHTML = "";

            const correctChar = todayWords[Math.floor(Math.random() * todayWords.length)];
            const voc = await getVocab(correctChar);
            const allVoc = [...voc.v2, ...voc.v3, ...voc.v4];

            if(allVoc.length === 0) { startQuiz(); return; }

            const target = allVoc[Math.floor(Math.random() * allVoc.length)];
            qText.innerHTML = `è«‹é¸å‡ºæ­£ç¢ºçš„å­—ï¼š<br><b style="color:var(--p); font-size:3rem;">${target.replace(correctChar, " â–¡ ")}</b>`;

            let options = [correctChar];
            while(options.length < 4) {
                let r = todayWords[Math.floor(Math.random() * todayWords.length)];
                if(!options.includes(r)) options.push(r);
            }
            options.sort(() => Math.random() - 0.5);

            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'opt-btn';
                btn.innerText = opt;
                btn.onclick = () => {
                    if(opt === correctChar) {
                        score += 1;
                        document.getElementById('star-count').innerText = score;
                        speak("ç­”å°äº†ï¼Œå¦³å¥½å²å®³ï¼");
                        startQuiz();
                    } else {
                        speak("å†è©¦ä¸€æ¬¡");
                        btn.style.background = "#ffeaa7";
                    }
                };
                qOpts.appendChild(btn);
            });
        }

        init();
    </script>
</body>
</html>
