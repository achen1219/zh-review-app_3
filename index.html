<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥³å…’çš„ä¸­æ–‡æ¢éšª</title>
    <style>
        :root { --p: #6c5ce7; --s: #a29bfe; --bg: #f9f9fb; }
        body { font-family: "Microsoft JhengHei", "æ•™è‚²éƒ¨æ¨™æº–æ¥·æ›¸", sans-serif; background: var(--bg); margin: 0; padding-bottom: 50px; }
        nav { background: white; padding: 15px; display: flex; justify-content: center; gap: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
        nav button { padding: 12px 25px; border: none; border-radius: 25px; font-weight: bold; cursor: pointer; background: #f1f2f6; color: #747d8c; font-size: 1.1rem; }
        nav button.active { background: var(--p); color: white; }
        .container { max-width: 600px; margin: 20px auto; padding: 0 15px; }
        .word-card { background: white; border-radius: 20px; padding: 25px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .big-char { font-size: 80px; color: var(--p); cursor: pointer; font-weight: bold; line-height: 1.2; text-align: center; }
        .vocab-item { font-size: 1.3rem; margin: 12px 0; color: #444; cursor: pointer; text-align: left; border-bottom: 1px dashed #eee; padding-bottom: 5px; }
        .vocab-item:before { content: "â­ "; }
        .tag { padding: 4px 12px; border-radius: 10px; color: white; font-size: 0.9rem; margin-bottom: 10px; display: inline-block; font-weight: bold; }
        #game-tab { display: none; text-align: center; }
        .opt-btn { width: 100%; padding: 20px; margin: 10px 0; font-size: 1.8rem; border: 2px solid #ddd; border-radius: 15px; background: white; cursor: pointer; font-weight: bold; }
        .loading { font-size: 1.2rem; color: #a4b0be; text-align: center; margin-top: 50px; }
    </style>
</head>
<body>

<nav>
    <button id="nav-learn" class="active" onclick="showTab('learn')">ğŸ“– å­¸ç¿’æ¨¡å¼</button>
    <button id="nav-game" onclick="showTab('game')">ğŸ® æŒ‘æˆ°éŠæˆ²</button>
</nav>

<div class="container">
    <h2 id="date-info" style="text-align: center; color: #57606f;">è¼‰å…¥ä¸­...</h2>

    <div id="learn-tab">
        <div id="word-list" class="loading">æ­£åœ¨æº–å‚™ä»Šå¤©çš„èª²ç¨‹...</div>
    </div>

    <div id="game-tab">
        <div style="background: white; padding: 30px; border-radius: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.05);">
            <div id="score" style="font-size: 1.2rem; color: #ffa502; font-weight: bold; margin-bottom: 10px;">æ˜Ÿæ˜Ÿï¼š0 â­</div>
            <div id="q-text" style="font-size: 1.8rem; margin: 20px 0; min-height: 100px;"></div>
            <div id="q-options"></div>
        </div>
    </div>
</div>

<script>
    const synth = window.speechSynthesis;
    let score = 0;
    let currentDayWords = [];

    // å–å¾—ä»Šå¤©æ—¥æœŸ
    const today = new Date().toISOString().split('T')[0];

    async function init() {
        try {
            // å¾ GitHub è®€å–åŒç›®éŒ„ä¸‹çš„ schedule.json
            const response = await fetch('schedule.json');
            const scheduleData = await response.json();
            
            // æ‰¾å‡ºä»Šå¤©çš„å–®å­—ï¼Œå¦‚æœä»Šå¤©æ²’æ’èª²ï¼Œå°±é¡¯ç¤ºæœ€å¾Œä¸€å¤©
            if (scheduleData[today]) {
                currentDayWords = scheduleData[today];
                document.getElementById('date-info').innerText = "ğŸ“… " + today + " ç·´ç¿’";
            } else {
                const dates = Object.keys(scheduleData);
                const lastDate = dates[dates.length - 1];
                currentDayWords = scheduleData[lastDate];
                document.getElementById('date-info').innerText = "ğŸ“… è¤‡ç¿’æ—¥æœŸï¼š" + lastDate;
            }
            
            renderLearn();
        } catch (e) {
            document.getElementById('word-list').innerHTML = "âŒ ç„¡æ³•è®€å– schedule.jsonï¼Œè«‹ç¢ºèªæª”æ¡ˆåœ¨ GitHub å°ˆæ¡ˆä¸­ã€‚";
        }
    }

    async function fetchVocab(char) {
        try {
            // ä½¿ç”¨èŒå…¸ API (åœ¨ GitHub Pages ç’°å¢ƒä¸‹é€šå¸¸å¯ä»¥ç›´æ¥è®€å–)
            const response = await fetch(`https://www.moedict.tw/api/v2/index/${encodeURIComponent(char)}`);
            const data = await response.json();
            const list = data.relates || [];
            return {
                v2: list.filter(v => v.length === 2).slice(0, 3),
                v3: list.filter(v => v.length === 3).slice(0, 1),
                v4: list.filter(v => v.length >= 4).slice(0, 1)
            };
        } catch (e) {
            return { v2: [char+"å­", char+"å¿ƒ"], v3: [], v4: [] };
        }
    }

    async function renderLearn() {
        const container = document.getElementById('word-list');
        let html = "";

        for (let i = 0; i < currentDayWords.length; i++) {
            const char = currentDayWords[i];
            const isNew = i < 2;
            const voc = await fetchVocab(char);

            html += `
                <div class="word-card">
                    <span class="tag" style="background:${isNew ? '#ff7675':'#55efc4'}">${isNew ? 'âœ¨ ä»Šæ—¥æ–°è©':'ğŸ”„ æº«æ•…çŸ¥æ–°'}</span>
                    <div style="display:flex; flex-direction:column; align-items:center;">
                        <div class="big-char" onclick="speak('${char}')">${char}</div>
                        <div style="width:100%; margin-top:15px;">
                            ${voc.v2.map(v => `<div class="vocab-item" onclick="speak('${v}')">${v}</div>`).join('')}
                            ${voc.v3.map(v => `<div class="vocab-item" onclick="speak('${v}')">${v}</div>`).join('')}
                            ${voc.v4.map(v => `<div class="vocab-item" onclick="speak('${v}')">${v}</div>`).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        container.innerHTML = html;
        container.className = ""; 
    }

    function showTab(tab) {
        document.getElementById('learn-tab').style.display = tab === 'learn' ? 'block' : 'none';
        document.getElementById('game-tab').style.display = tab === 'game' ? 'block' : 'none';
        document.getElementById('nav-learn').className = tab === 'learn' ? 'active' : '';
        document.getElementById('nav-game').className = tab === 'game' ? 'active' : '';
        if(tab === 'game') initGame();
    }

    async function initGame() {
        const qText = document.getElementById('q-text');
        const qOpts = document.getElementById('q-options');
        qText.innerText = "ğŸ² æ­£åœ¨å‡ºé¡Œ...";
        qOpts.innerHTML = "";

        const correctChar = currentDayWords[Math.floor(Math.random() * currentDayWords.length)];
        const voc = await fetchVocab(correctChar);
        const allVoc = [...voc.v2, ...voc.v3, ...voc.v4];

        if(allVoc.length === 0) { initGame(); return; }

        const target = allVoc[Math.floor(Math.random() * allVoc.length)];
        qText.innerHTML = `è«‹é¸å‡ºæ­£ç¢ºçš„å­—ï¼š<br><b style="font-size:2.8rem; color:var(--p);">${target.replace(correctChar, " â–¡ ")}</b>`;

        let options = [correctChar];
        while(options.length < 4) {
            let r = currentDayWords[Math.floor(Math.random() * currentDayWords.length)];
            if(!options.includes(r)) options.push(r);
        }
        options.sort(() => Math.random() - 0.5);

        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            btn.innerText = opt;
            btn.onclick = () => {
                if(opt === correctChar) {
                    score++;
                    document.getElementById('score').innerT
